#include <stdio.h>
#include <math.h>

#define ADC_BUF_SIZE    480
#define M_PI            3.141592653589793f

static void czt(unsigned char* x, float* oup, float f1, float f2, unsigned int N, unsigned int M);
void ComplexFFT(float vector[], unsigned int sample_rate, int sign);

unsigned char x[ADC_BUF_SIZE] = {115, 135, 149, 154, 149, 135, 115, 96, 82, 77, 82, 96, 115, 135, 149, 154, 149, 135, 115, 96, 82, 77, 82, 96, 115, 135, 149, 154, 149, 135, 115, 96, 82, 77, 82, 96, 115, 135, 149, 154, 149, 135, 115, 96, 82, 77, 82, 96, 115, 135, 149, 154, 149, 135, 115, 96, 82, 77, 82, 96, 115, 135, 149, 154, 149, 135, 115, 96, 82, 77, 82, 96, 115, 135, 149, 154, 149, 135, 115, 96, 82, 77, 82, 96, 115, 135, 149, 154, 149, 135, 115, 96, 82, 77, 82, 96, 115, 135, 149, 154, 
149, 135, 115, 96, 82, 77, 82, 96, 115, 135, 149, 154, 149, 135, 115, 96, 82, 77, 82, 96, 115, 135, 149, 154, 149, 135, 115, 96, 82, 77, 82, 96, 115, 135, 149, 154, 149, 135, 115, 96, 82, 77, 82, 96, 115, 135, 149, 154, 149, 135, 115, 96, 82, 77, 82, 96, 115, 135, 149, 154, 149, 135, 115, 96, 82, 77, 82, 96, 115, 135, 149, 154, 149, 135, 115, 96, 82, 77, 82, 96, 115, 135, 149, 154, 149, 135, 115, 96, 82, 77, 82, 96, 115, 135, 149, 154, 149, 135, 115, 96, 
82, 77, 82, 96, 115, 135, 149, 154, 149, 135, 115, 96, 82, 77, 82, 96, 115, 135, 149, 154, 149, 135, 115, 96, 82, 77, 82, 96, 115, 135, 149, 154, 149, 135, 115, 96, 82, 77, 82, 96, 115, 135, 149, 154, 149, 135, 115, 96, 82, 77, 82, 96, 115, 135, 149, 154, 149, 135, 115, 96, 82, 77, 82, 96, 115, 135, 149, 154, 149, 135, 115, 96, 82, 77, 82, 96, 115, 135, 149, 154, 149, 135, 115, 96, 82, 77, 82, 96, 115, 135, 149, 154, 149, 135, 115, 96, 82, 77, 82, 96, 
115, 135, 149, 154, 149, 135, 115, 96, 82, 77, 82, 96, 115, 135, 149, 154, 149, 135, 115, 96, 82, 77, 82, 96, 115, 135, 149, 154, 149, 135, 115, 96, 82, 77, 82, 96, 115, 135, 149, 154, 149, 135, 115, 96, 82, 77, 82, 96, 115, 135, 149, 154, 149, 135, 115, 96, 82, 77, 82, 96, 115, 135, 149, 154, 149, 135, 115, 96, 82, 77, 82, 96, 115, 135, 149, 154, 149, 135, 115, 96, 82, 77, 82, 96, 115, 135, 149, 154, 149, 135, 115, 96, 82, 77, 82, 96, 115, 135, 149, 154, 
149, 135, 115, 96, 82, 77, 82, 96, 115, 135, 149, 154, 149, 135, 115, 96, 82, 77, 82, 96, 115, 135, 149, 154, 149, 135, 115, 96, 82, 77, 82, 96, 115, 135, 149, 154, 149, 135, 115, 96, 82, 77, 82, 96, 115, 135, 149, 154, 149, 135, 115, 96, 82, 77, 82, 96, 115, 135, 149, 154, 149, 135, 115, 96, 82, 77, 82, 96, 115, 135, 149, 154, 149, 135, 115, 96, 82, 77, 82, 96};

float cztout[545];

int main(void) 
{
	float f1, f2, maxmag;
	unsigned int maxidx,  i;
	
	maxidx = 43;
	
	f1 = (maxidx - 1)/512.0f;	/* zoom-in one bin to the left and right */
	if(maxidx == 255)
		f2 = maxidx/512.0f;
	else
		f2 = (maxidx + 1)/512.0f;

	czt(x, cztout, f1, f2, ADC_BUF_SIZE, 545);
    
    maxmag = 0;
    for(i = 0; i < 545; i++){
        if(cztout[i] > maxmag){
            maxmag = cztout[i];
            maxidx = i;
        }
    }
    
    printf("maxidx, freq := %u, %f\n\n", maxidx, 48000*(f1 + maxidx*(f2 - f1)/545.0));
    
    printf("oup = [");
    for(i = 0; i < 545; i++){
        if(i == 544)
            printf("%f", cztout[i]);
        else
            printf("%f, ", cztout[i]);
            
        if((i+1)%100 == 0)
            printf("...\n");
    }
    printf("];");
    
	return 0;
}


float chrp[1090] = {1.000000, 0.000000, 1.000000, -0.000023, 1.000000, -0.000090, 1.000000, -0.000203, 1.000000, -0.000360, 1.000000, -0.000563, 1.000000, -0.000811, 0.999999, -0.001103, 0.999999, -0.001441, 0.999998, -0.001824, 0.999997, -0.002252, 0.999996, -0.002725, 0.999995, -0.003242, 0.999993, -0.003805, 0.999990, -0.004413, 0.999987, -0.005066, 0.999983, -0.005764, 0.999979, -0.006507, 0.999973, -0.007295, 0.999967, -0.008129, 0.999959, -0.009007, 0.999951, -0.009930, 0.999941, -0.010898, 0.999929, -0.011911, 0.999916, -0.012970, 0.999901, -0.014073, 0.999884, -0.015221, 0.999865, -0.016414, 0.999844, -0.017653, 0.999821, -0.018936, 0.999795, -0.020264, 0.999766, -0.021637, 0.999734, -0.023056, 0.999699, -0.024519, 0.999661, -0.026027, 0.999620, -0.027580, 0.999574, -0.029178, 0.999525, -0.030821, 0.999471, -0.032509, 0.999414, -0.034242, 0.999351, -0.036020, 0.999284, -0.037842, 0.999211, -0.039710, 0.999133, -0.041622, 0.999050, -0.043579, 0.998961, -0.045581, 0.998865, -0.047628, 0.998763, -0.049720, 0.998655, -0.051856, 0.998539, -0.054037, 
0.998416, -0.056263, 0.998285, -0.058534, 0.998147, -0.060849, 0.998000, -0.063209, 0.997845, -0.065613, 0.997681, -0.068062, 0.997508, -0.070555, 0.997325, -0.073093, 0.997133, -0.075675, 0.996930, -0.078302, 0.996716, -0.080973, 0.996492, -0.083688, 0.996256, -0.086448, 0.996009, -0.089252, 0.995750, -0.092100, 0.995478, -0.094992, 0.995194, -0.097928, 0.994896, -0.100907, 0.994584, -0.103931, 0.994259, -0.106999, 0.993919, -0.110110, 0.993565, -0.113265, 0.993195, -0.116464, 0.992809, -0.119706, 0.992408, -0.122992, 0.991989, -0.126321, 0.991554, -0.129693, 0.991102, -0.133108, 0.990631, -0.136566, 0.990142, -0.140067, 0.989634, -0.143611, 0.989107, -0.147198, 0.988560, -0.150828, 0.987993, -0.154499, 0.987405, -0.158213, 0.986796, -0.161970, 0.986165, -0.165768, 0.985512, -0.169608, 0.984836, -0.173490, 0.984136, -0.177414, 0.983413, -0.181379, 0.982666, -0.185386, 0.981894, -0.189433, 0.981096, -0.193522, 0.980272, -0.197651, 0.979422, -0.201821, 0.978545, -0.206032, 0.977641, -0.210282, 0.976708, -0.214573, 0.975747, -0.218904, 
0.974756, -0.223274, 0.973735, -0.227683, 0.972684, -0.232131, 0.971603, -0.236619, 0.970489, -0.241145, 0.969344, -0.245710, 0.968165, -0.250312, 0.966954, -0.254953, 0.965708, -0.259631, 0.964428, -0.264346, 0.963112, -0.269099, 0.961761, -0.273888, 0.960374, -0.278714, 0.958950, -0.283576, 0.957488, -0.288474, 0.955987, -0.293408, 0.954448, -0.298376, 0.952870, -0.303379, 0.951251, -0.308417, 0.949592, -0.313489, 0.947891, -0.318595, 0.946148, -0.323734, 0.944363, -0.328906, 0.942534, -0.334111, 0.940661, -0.339348, 0.938743, -0.344617, 0.936781, -0.349917, 0.934772, -0.355248, 0.932717, -0.360609, 0.930615, -0.366001, 0.928464, -0.371422, 0.926265, -0.376872, 0.924017, -0.382351, 0.921719, -0.387857, 0.919371, -0.393392, 0.916971, -0.398953, 0.914520, -0.404541, 0.912016, -0.410155, 0.909458, -0.415795, 0.906847, -0.421459, 0.904182, -0.427148, 0.901461, -0.432860, 0.898684, -0.438596, 0.895851, -0.444354, 0.892961, -0.450134, 0.890013, -0.455936, 0.887006, -0.461757, 0.883940, -0.467599, 0.880815, -0.473461, 0.877629, -0.479341, 
0.874382, -0.485238, 0.871073, -0.491154, 0.867702, -0.497085, 0.864268, -0.503032, 0.860770, -0.508995, 0.857207, -0.514972, 0.853580, -0.520962, 0.849887, -0.526965, 0.846128, -0.532980, 0.842302, -0.539006, 0.838409, -0.545042, 0.834447, -0.551088, 0.830417, -0.557142, 0.826318, -0.563204, 0.822149, -0.569273, 0.817909, -0.575348, 0.813598, -0.581428, 0.809215, -0.587512, 0.804761, -0.593599, 0.800233, -0.599689, 0.795632, -0.605780, 0.790958, -0.611871, 0.786208, -0.617962, 0.781384, -0.624050, 0.776484, -0.630137, 0.771508, -0.636219, 0.766456, -0.642297, 0.761326, -0.648369, 0.756119, -0.654434, 0.750834, -0.660491, 0.745471, -0.666538, 0.740028, -0.672576, 0.734506, -0.678602, 0.728904, -0.684616, 0.723222, -0.690616, 0.717458, -0.696601, 0.711614, -0.702570, 0.705688, -0.708522, 0.699681, -0.714456, 0.693590, -0.720370, 0.687418, -0.726262, 0.681162, -0.732133, 0.674822, -0.737980, 0.668400, -0.743802, 0.661893, -0.749599, 0.655302, -0.755367, 0.648626, -0.761107, 0.641865, -0.766817, 0.635020, -0.772496, 0.628089, -0.778142, 
0.621072, -0.783753, 0.613970, -0.789329, 0.606783, -0.794868, 0.599509, -0.800368, 0.592149, -0.805829, 0.584702, -0.811248, 0.577170, -0.816624, 0.569551, -0.821956, 0.561845, -0.827243, 0.554053, -0.832482, 0.546174, -0.837672, 0.538209, -0.842812, 0.530157, -0.847900, 0.522019, -0.852934, 0.513794, -0.857914, 0.505483, -0.862837, 0.497085, -0.867702, 0.488602, -0.872507, 0.480032, -0.877251, 0.471377, -0.881932, 0.462636, -0.886548, 0.453810, -0.891099, 0.444899, -0.895581, 0.435903, -0.899994, 0.426822, -0.904336, 0.417657, -0.908605, 0.408409, -0.912799, 0.399077, -0.916917, 0.389662, -0.920958, 0.380165, -0.924919, 0.370585, -0.928798, 0.360924, -0.932595, 0.351182, -0.936307, 0.341359, -0.939933, 0.331457, -0.943470, 0.321475, -0.946918, 0.311414, -0.950274, 0.301276, -0.953537, 0.291060, -0.956705, 0.280768, -0.959776, 0.270400, -0.962748, 0.259957, -0.965620, 0.249440, -0.968390, 0.238850, -0.971057, 0.228187, -0.973617, 0.217453, -0.976071, 0.206649, -0.978415, 0.195775, -0.980649, 0.184833, -0.982770, 0.173823, -0.984777, 
0.162747, -0.986668, 0.151607, -0.988441, 0.140402, -0.990095, 0.129135, -0.991627, 0.117806, -0.993037, 0.106417, -0.994322, 0.094969, -0.995480, 0.083464, -0.996511, 0.071903, -0.997412, 0.060287, -0.998181, 0.048618, -0.998817, 0.036897, -0.999319, 0.025126, -0.999684, 0.013307, -0.999911, 0.001441, -0.999999, -0.010470, -0.999945, -0.022425, -0.999749, -0.034422, -0.999407, -0.046459, -0.998920, -0.058534, -0.998285, -0.070645, -0.997502, -0.082791, -0.996567, -0.094969, -0.995480, -0.107178, -0.994240, -0.119416, -0.992844, -0.131680, -0.991292, -0.143968, -0.989582, -0.156279, -0.987713, -0.168610, -0.985683, -0.180959, -0.983491, -0.193323, -0.981135, -0.205701, -0.978615, -0.218091, -0.975929, -0.230488, -0.973075, -0.242893, -0.970053, -0.255301, -0.966862, -0.267711, -0.963499, -0.280120, -0.959965, -0.292525, -0.956258, -0.304924, -0.952377, -0.317314, -0.948320, -0.329693, -0.944088, -0.342058, -0.939679, -0.354406, -0.935092, -0.366734, -0.930326, -0.379040, -0.925380, -0.391321, -0.920254, -0.403573, -0.914947, -0.415795, -0.909458, -0.427983, -0.903787, 
-0.440133, -0.897932, -0.452244, -0.891894, -0.464312, -0.885672, -0.476334, -0.879264, -0.488307, -0.872672, -0.500227, -0.865894, -0.512093, -0.858930, -0.523899, -0.851780, -0.535644, -0.844444, -0.547324, -0.836921, -0.558936, -0.829211, -0.570476, -0.821315, -0.581941, -0.813231, -0.593327, -0.804961, -0.604633, -0.796505, -0.615853, -0.787861, -0.626984, -0.779032, -0.638024, -0.770016, -0.648968, -0.760815, -0.659814, -0.751429, -0.670557, -0.741858, -0.681195, -0.732102, -0.691723, -0.722163, -0.702138, -0.712041, -0.712436, -0.701737, -0.722615, -0.691251, -0.732670, -0.680585, -0.742597, -0.669738, -0.752394, -0.658714, -0.762056, -0.647511, -0.771580, -0.636132, -0.780962, -0.624578, -0.790199, -0.612850, -0.799287, -0.600949, -0.808222, -0.588878, -0.817001, -0.576636, -0.825620, -0.564227, -0.834075, -0.551651, -0.842363, -0.538911, -0.850480, -0.526008, -0.858422, -0.512943, -0.866187, -0.499720, -0.873769, -0.486341, -0.881167, -0.472806, -0.888375, -0.459119, -0.895390, -0.445282, -0.902210, -0.431297, -0.908830, -0.417166, -0.915247, -0.402893, -0.921457, -0.388480, 
-0.927457, -0.373929, -0.933244, -0.359244, -0.938813, -0.344426, -0.944162, -0.329480, -0.949288, -0.314409, -0.954186, -0.299214, -0.958854, -0.283900, -0.963288, -0.268470, -0.967485, -0.252927, -0.971442, -0.237275, -0.975156, -0.221517, -0.978624, -0.205657, -0.981842, -0.189699, -0.984808, -0.173646, -0.987519, -0.157502, -0.989971, -0.141271, -0.992162, -0.124958, -0.994089, -0.108566, -0.995750, -0.092100, -0.997141, -0.075563, -0.998260, -0.058961, -0.999105, -0.042297, -0.999673, -0.025577, -0.999961, -0.008804, -0.999968, 0.008016, -0.999690, 0.024879, -0.999127, 0.041780, -0.998275, 0.058713, -0.997133, 0.075675, -0.995698, 0.092660, -0.993969, 0.109663, -0.991944, 0.126678, -0.989621, 0.143701, -0.986999, 0.160725, -0.984076, 0.177747, -0.980851, 0.194759, -0.977322, 0.211757, -0.973489, 0.228735, -0.969349, 0.245688, -0.964902, 0.262609, -0.960148, 0.279493, -0.955084, 0.296334, -0.949712, 0.313126, -0.944029, 0.329863, -0.938035, 0.346540, -0.931731, 0.363149, -0.925116, 0.379686, -0.918189, 0.396143, -0.910951, 0.412516, -0.903401, 0.428796, 
-0.895541, 0.444979, -0.887370, 0.461058, -0.878889, 0.477027, -0.870098, 0.492879, -0.860999, 0.508607, -0.851591, 0.524206, -0.841877, 0.539669, -0.831857, 0.554990, -0.821533, 0.570161, -0.810905, 0.585177, -0.799977, 0.600031, -0.788748, 0.614717, -0.777222, 0.629227, -0.765399, 0.643556, -0.753283, 0.657696, -0.740876, 0.671642, -0.728179, 0.685387, -0.715196, 0.698924, -0.701929, 0.712247, -0.688382, 0.725349, -0.674557, 0.738223, -0.660457, 0.750864, -0.646086, 0.763265, -0.631447, 0.775419, -0.616544, 0.787320, -0.601381, 0.798962, -0.585962, 0.810338, -0.570291, 0.821443, -0.554371, 0.832269, -0.538209, 0.842812, -0.521807, 0.853063, -0.505172, 0.863019, -0.488307, 0.872672, -0.471218, 0.882017, -0.453910, 0.891047, -0.436389, 0.899758, -0.418660, 0.908143, -0.400728, 0.916197, -0.382600, 0.923914, -0.364282, 0.931289, -0.345779, 0.938316, -0.327098, 0.944990, -0.308246, 0.951307, -0.289229, 0.957260, -0.270053, 0.962845, -0.250726, 0.968058, -0.231255, 0.972893, -0.211647, 0.977346, -0.191909, 0.981413, -0.172049, 0.985088, 
-0.152074, 0.988369, -0.131992, 0.991251, -0.111811, 0.993729, -0.091539, 0.995801, -0.071184, 0.997463, -0.050754, 0.998711, -0.030258, 0.999542, -0.009705, 0.999953, 0.010898, 0.999941, 0.031541, 0.999502, 0.052216, 0.998636, 0.072913, 0.997338, 0.093624, 0.995608, 0.114339, 0.993442, 0.135049, 0.990839, 0.155745, 0.987797, 0.176417, 0.984316, 0.197055, 0.980392, 0.217651, 0.976027, 0.238194, 0.971218, 0.258674, 0.965965, 0.279082, 0.960267, 0.299407, 0.954125, 0.319641, 0.947539, 0.339772, 0.940508, 0.359790, 0.933033, 0.379686, 0.925116, 0.399449, 0.916756, 0.419069, 0.907955, 0.438535, 0.898714, 0.457838, 0.889035, 0.476967, 0.878921, 0.495912, 0.868373, 0.514663, 0.857393, 0.533208, 0.845984, 0.551538, 0.834149, 0.569643, 0.821892, 0.587512, 0.809215, 0.605135, 0.796123, 0.622501, 0.782619, 0.639601, 0.768707, 0.656423, 0.754393, 0.672959, 0.739680, 0.689198, 0.724573, 0.705130, 0.709078, 0.720744, 0.693201, 0.736032, 0.676947, 0.750983, 0.660322, 0.765588, 0.643332, 0.779836, 0.625984, 
0.793719, 0.608285, 0.807227, 0.590242, 0.820350, 0.571862, 0.833080, 0.553153, 0.845407, 0.534122, 0.857323, 0.514779, 0.868819, 0.495130, 0.879886, 0.475185, 0.890515, 0.454953, 0.900699, 0.434443, 0.910430, 0.413664, 0.919698, 0.392626, 0.928498, 0.371338, 0.936820, 0.349811, 0.944658, 0.328056, 0.952005, 0.306082, 0.958854, 0.283900, 0.965197, 0.261522, 0.971030, 0.238959, 0.976344, 0.216222, 0.981135, 0.193323, 0.985397, 0.170274, 0.989124, 0.147087, 0.992310, 0.123774, 0.994952, 0.100347, 0.997045, 0.076820, 0.998584, 0.053205, 0.999564, 0.029516, 0.999983, 0.005764, 0.999837, -0.018035, 0.999123, -0.041870, 0.997838, -0.065725, 0.995979, -0.089588, 0.993544, -0.113444, 0.990532, -0.137280, 0.986941, -0.161081, 0.982770, -0.184833, 0.978018, -0.208521, 0.972684, -0.232131, 0.966770, -0.255649, 0.960274, -0.279060, 0.953197, -0.302349, 0.945541, -0.325502, 0.937308, -0.348503, 0.928498, -0.371338};

/**
* @brief  Compute the chirp-z transform of the signal in given frequency range.
* @param  x: input signal (real)
* @param  oup: transformed output magnitude
* @param  f1: start frequency as a fraction of fs
* @param  f2: end frequency as a fraction of fs
* @param  N: no. of elements in x
* @param  M: no. of output transform points. Should be such that N+M-1 is a power of 2.
* @retval None
*/
static void czt(unsigned char* x, float* oup, float f1, float f2, unsigned int N, unsigned int M)
{
	unsigned int L, i;
	float theta0, phi0;		/* A = exp(j*theta0), W = exp(j*phi0) */
	float c1, s1, c2, s2, a, b;

	L = N + M - 1;
	theta0 = 2.0f*M_PI*f1;
	phi0 = -2.0f*M_PI*(f2 - f1)/(float)M;

	float yY[2*L], vV[2*L];

	/* yn = A^-n * W^(n^2/2) * xn */
	for(i = 0; i < N; i++){
		c1 = cos(-(float)i*theta0);
		s1 = sin(-(float)i*theta0);
		c2 = chrp[2*i];
		s2 = chrp[2*i+1];
		yY[2*i] = (c1*c2 - s1*s2) * (float)x[i];		/* real */
		yY[2*i+1] = (c1*s2 + c2*s1) * (float)x[i];		/* imaginary */
	}
	for(i = N; i < L; i++){
		yY[2*i] = 0;
		yY[2*i+1] = 0;
	}

	/* FFT(yY) */
    ComplexFFT(yY, L, 1);

	/* vn = W^(-n^2/2) for 0<=n<=M-1 */
	for(i = 0; i < M; i++){
		vV[2*i] = chrp[2*i];
		vV[2*i+1] = -chrp[2*i+1];
	}
	/* vn = W^(-(L-n)^2/2) for M<=n<=L-1 */
	for(i = M; i < L; i++){
		vV[2*i] = vV[2*(L-i)];		/* exploit symmetry to reuse values from 0 to M-1 */
		vV[2*i+1] = vV[2*(L-i)+1];
	}

	/* FFT(vV) */
    ComplexFFT(vV, L, 1);

	/* FFT(yY)*FFT(vV) */
	for(i = 0; i < L; i++){
	    a = yY[2*i];
	    b = yY[2*i+1];
	    yY[2*i] = a*vV[2*i] - b*vV[2*i+1];
	    yY[2*i+1] = a*vV[2*i+1] + b*vV[2*i];
	}

	/* gn = IFFT[FFT(yY)*FFT(vV)] */
    ComplexFFT(yY, L, -1);

	/* oup[n] = W^(n^2/2)*gn */
	for(i = 0; i < M; i++){
		c1 = chrp[2*i];
		s1 = chrp[2*i+1];
		vV[2*i] = c1*yY[2*i] - s1*yY[2*i+1];
		vV[2*i+1] = c1*yY[2*i+1] + s1*yY[2*i];
	}

    float* test = vV;
	for(i = 0; i < M; i++){
        oup[i] = sqrt(test[2*i]*test[2*i] + test[2*i+1]*test[2*i+1]);
	}

	return;
}


#define SWAP(a,b) tempr=(a);(a)=(b);(b)=tempr

// FFT 1D
void ComplexFFT(float vector[], unsigned int sample_rate, int sign)
{
	//variables for the fft
	unsigned long n,mmax,m,j,istep,i;
	float wtemp,wr,wpr,wpi,wi,theta,tempr,tempi;

	//the complex array is real+complex so the array
    //as a size n = 2* number of complex samples
    //real part is the data[index] and
    //the complex part is the data[index+1]

	//binary inversion (note that the indexes
    //start from 0 witch means that the
    //real part of the complex is on the even-indexes
    //and the complex part is on the odd-indexes)
	n=sample_rate << 1;
	j=0;
	for (i=0;i<n/2;i+=2) {
		if (j > i) {
			SWAP(vector[j],vector[i]);
			SWAP(vector[j+1],vector[i+1]);
			if((j/2)<(n/4)){
				SWAP(vector[(n-(i+2))],vector[(n-(j+2))]);
				SWAP(vector[(n-(i+2))+1],vector[(n-(j+2))+1]);
			}
		}
		m=n >> 1;
		while (m >= 2 && j >= m) {
			j -= m;
			m >>= 1;
		}
		j += m;
	}
	//end of the bit-reversed order algorithm

	//Danielson-Lanzcos routine
	mmax=2;
	while (n > mmax) {
		istep=mmax << 1;
		theta=sign*(2.0f*M_PI/(float)mmax);
		wtemp=sin(0.5f*theta);
		wpr = -2.0f*wtemp*wtemp;
		wpi=sin(theta);
		wr=1.0f;
		wi=0.0f;
		for (m=1;m<mmax;m+=2) {
			for (i=m;i<=n;i+=istep) {
				j=i+mmax;
				tempr=wr*vector[j-1]-wi*vector[j];
				tempi=wr*vector[j]+wi*vector[j-1];
				vector[j-1]=vector[i-1]-tempr;
				vector[j]=vector[i]-tempi;
				vector[i-1] += tempr;
				vector[i] += tempi;
			}
			wr=(wtemp=wr)*wpr-wi*wpi+wr;
			wi=wi*wpr+wtemp*wpi+wi;
		}
		mmax=istep;
	}
	//end of the algorithm
}

